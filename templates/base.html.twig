{# templates/base.html.twig #}
<!DOCTYPE html>
<html lang="fr" class="h-100">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Mon appli{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {# Bootstrap 5 + Icons #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body            { background-color:#f8f9fa; }      /* gris très clair */

        /* --- SIDEBAR (desktop ≥ md) ------------------------------------ */
        .sidebar        { background:linear-gradient(180deg,#0055A5,#0078D4); color:#fff; min-height:100vh; }
        .sidebar a      { color:#fff; text-decoration:none; }
        .sidebar a:hover,
        .sidebar .nav-link:hover { background-color:rgba(255,255,255,.15); border-radius:.375rem; }
        .sidebar .nav-link.active { background-color:rgba(255,255,255,.25); border-radius:.375rem; }

        /* petits titres de section */
        .menu-title     { font-size:.76rem; letter-spacing:.06em; }
        .menu-sep       { border-color:rgba(255,255,255,.4); opacity:.7; }

        /* --- OFFCANVAS (mobile < md) ----------------------------------- */
        .offcanvas-header        { background-color:#0055A5; color:#fff; }
        .offcanvas .nav-link.active,
        .offcanvas .nav-link:hover { background-color:rgba(0,85,165,.1); border-radius:.375rem; }
    </style>

    {% block stylesheets %}{% endblock %}
</head>
<body class="d-flex">

{# ────────────────────────────── SIDEBAR (desktop) ───────────────────────────── #}
{% if is_granted('ROLE_USER') %}

<nav class="sidebar d-none d-md-flex flex-column p-3" style="width:250px;">
    <h4 class="mb-4">JW - Parking</h4>

    <div class="menu-title text-uppercase fw-bold opacity-75 mb-2">Navigation</div>
    <ul class="nav nav-pills flex-column gap-2">
        <li>
            <a class="nav-link {% if app.request.get('_route') == 'app_dashboard' %}active{% endif %}"
               href="{{ path('app_dashboard') }}">
                <i class="bi bi-house-door me-2"></i>Tableau de bord
            </a>
        </li>
        <li>
            <a class="nav-link {% if app.request.get('_route') starts with 'app_profile' %}active{% endif %}"
               href="{{ path('app_profile') }}">
                <i class="bi bi-person-circle me-2"></i>Mon profil
            </a>
        </li>
        <li>
            <a class="nav-link {% if app.request.get('_route') starts with 'rondes' %}active{% endif %}"
               href="{{ path('user_my_rounds') }}">
                <i class="bi bi-shield-check me-2"></i>Rondes
            </a>
        </li>
        <li>
            <a class="nav-link {% if app.request.get('_route') starts with 'rondes' %}active{% endif %}"
               href="{{ path('user_indispo_index') }}">
                <i class="bi bi-clock me-2"></i>Mes indisponibilitées
            </a>
        </li>
    </ul>

    {% if is_granted('ROLE_ADMIN') %}
        <hr class="my-3 menu-sep">
        <div class="menu-title text-uppercase fw-bold opacity-75 mb-2">Administration</div>
        <ul class="nav nav-pills flex-column gap-2">
            <li>
                <a class="nav-link {% if app.request.get('_route') starts with 'admin_rondes' %}active{% endif %}"
                   href="{{ path('admin_rondes_index') }}">
                    <i class="bi bi-tools me-2"></i>Gestion des rondes
                </a>
            </li>
            <li>
                <a class="nav-link {% if app.request.get('_route') starts with 'admin_users' %}active{% endif %}"
                   href="{{ path('admin_users_index') }}">
                    <i class="bi bi-people me-2"></i>Utilisateurs
                </a>
            </li>
        </ul>
    {% endif %}

    <hr class="my-3 menu-sep">
    <ul class="nav nav-pills flex-column gap-2">
        <li>
            <a class="nav-link" href="{{ path('app_logout') }}">
                <i class="bi bi-box-arrow-right me-2"></i>Déconnexion
            </a>
        </li>
    </ul>
</nav>
{% endif %}


{# ────────────────────────────── OFFCANVAS (mobile) ──────────────────────────── #}
<div class="d-md-none position-fixed top-0 start-0 w-100 bg-white shadow-sm z-3">
    <div class="d-flex justify-content-between align-items-center px-3 py-2 border-bottom">
        <span class="fw-bold" style="color:#0055A5;">JW - Parking</span>
        <button class="btn btn-outline-primary btn-sm" type="button"
                data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu">
            <i class="bi bi-list fs-4"></i>
        </button>
    </div>
</div>
{% if is_granted('ROLE_USER') %}

<div class="offcanvas offcanvas-start d-md-none" tabindex="-1" id="offcanvasMenu">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Menu</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>

    <div class="offcanvas-body">
        <div class="menu-title text-uppercase fw-bold opacity-75 mb-2">Navigation</div>
        <ul class="nav flex-column gap-2 mb-3">
            <li>
                <a class="nav-link {% if app.request.get('_route') == 'app_dashboard' %}active{% endif %}"
                   href="{{ path('app_dashboard') }}">
                    <i class="bi bi-house-door me-2"></i>Tableau de bord
                </a>
            </li>
            <li>
                <a class="nav-link {% if app.request.get('_route') starts with 'app_profile' %}active{% endif %}"
                   href="{{ path('app_profile') }}">
                    <i class="bi bi-person-circle me-2"></i>Mon profil
                </a>
            </li>
            <li>
                <a class="nav-link {% if app.request.get('_route') starts with 'rondes' %}active{% endif %}"
                   href="{{ path('user_my_rounds') }}">
                    <i class="bi bi-shield-check me-2"></i>Rondes
                </a>
            </li>
            <li>
                <a class="nav-link {% if app.request.get('_route') starts with 'rondes' %}active{% endif %}"
                   href="{{ path('user_indispo_index') }}">
                    <i class="bi bi-clock me-2"></i>Mes indisponibilitées
                </a>
            </li>
        </ul>

        {% if is_granted('ROLE_ADMIN') %}
            <hr class="menu-sep my-2">
            <div class="menu-title text-uppercase fw-bold opacity-75 mb-2">Administration</div>
            <ul class="nav flex-column gap-2 mb-3">
                <li>
                    <a class="nav-link {% if app.request.get('_route') starts with 'admin_rondes' %}active{% endif %}"
                       href="{{ path('admin_rondes_index') }}">
                        <i class="bi bi-tools me-2"></i>Gestion des rondes
                    </a>
                </li>
                <li>
                    <a class="nav-link {% if app.request.get('_route') starts with 'admin_users' %}active{% endif %}"
                       href="{{ path('admin_users_index') }}">
                        <i class="bi bi-people me-2"></i>Utilisateurs
                    </a>
                </li>
            </ul>
        {% endif %}

        <hr class="menu-sep my-2">
        <ul class="nav flex-column gap-2">
            <li>
                <a class="nav-link" href="{{ path('app_logout') }}">
                    <i class="bi bi-box-arrow-right me-2"></i>Déconnexion
                </a>
            </li>
        </ul>
    </div>
</div>
{% endif %}


{# ───────────────────────────── Main content area ────────────────────────────── #}
<div class="flex-grow-1 p-3 mt-5 mt-md-0">
    {% block body %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
{% block javascripts %}{% endblock %}
</body>
</html>
